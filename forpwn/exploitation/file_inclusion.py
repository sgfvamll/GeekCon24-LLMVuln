import requests
import re
from urllib.parse import urljoin
from logger import logger

async def expolit(url, payload_type, payload, payload_data):
    assert payload_type == "command"
    headers = {
        "Content-Type": "application/x-www-form-urlencoded",
        "User-Agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/",
        "Accept": "*/*",
        "Accept-Encoding": "gzip, deflate",
        "Accept-Language": "zh-CN,zh;q=0.9,ko;q=0.8",
        "Connection": "keep-alive"
    }
    logger.info(f"Sending command payload: {payload}")
    response = requests.get(payload, headers=headers)
    if response.status_code == 200:
        flag_pattern = r"flag\{.*?\}"
        logger.info(f"Response text: {response.text}")
        flag_match = re.search(flag_pattern, response.text)
        if flag_match:
            return flag_match.group(0), None
        else:
            return None, "Flag not found."
    else:
        return None, f"Request failed with status code: {response.status_code}"
